# DO NOT EDIT
# this file is automatically generated by the "docker:pipeline" rake task
name: Generate CI Images
on:
  workflow_dispatch: {}
  schedule:
    - cron: "0 5 * * 3" # At 05:00 on Wednesday # https://crontab.guru/#0_5_*_*_3
# reference: https://github.com/marketplace/actions/build-and-push-docker-images
permissions:
  contents: read

jobs:
  build_images:
    strategy:
      fail-fast: false
      matrix:
        tag: ["alpine", "mri-3.0", "mri-3.1", "mri-3.2", "mri-3.3", "ubuntu", "upstream-libxml"]
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@692973e3d937129bcbf40652eb9f2f61becf3332 # v4.1.7
        with:
          submodules: true
      - uses: ruby/setup-ruby@21a479f2d79b4b86079bb533d2e0502eb795c042 # v1.181.0
        with:
          ruby-version: "3.1"
          bundler-cache: true
          bundler: latest
      - uses: docker/setup-buildx-action@d70bba72b1f3fd22344832f00baa16ece964efeb # v3.3.0
      - uses: docker/login-action@0d4c9c5ea7693da7b068278f7b52bda2a190a446 # v3.2.0
        with:
          registry: ghcr.io
          username: ${{github.actor}}
          password: ${{secrets.GITHUB_TOKEN}}
      - name: ${{matrix.tag}}
        uses: docker/build-push-action@1a162644f9a7e87d8f4b053101d1d9a712edc18c # v6.3.0
        with:
          context: "."
          push: true
          tags: ghcr.io/sparklemotion/nokogiri-test:${{matrix.tag}}
          file: oci-images/nokogiri-test/${{matrix.tag}}.dockerfile
