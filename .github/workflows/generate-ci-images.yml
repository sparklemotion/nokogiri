# DO NOT EDIT
# this file is automatically generated by the "docker:pipeline" rake task
name: Generate CI Images
on:
  workflow_dispatch: {}
  schedule:
    - cron: "0 5 * * 3" # At 05:00 on Wednesday # https://crontab.guru/#0_5_*_*_3
# reference: https://github.com/marketplace/actions/build-and-push-docker-images
permissions:
  contents: read

jobs:
  build_images:
    strategy:
      fail-fast: false
      matrix:
        tag: ["alpine", "mri-2.7", "mri-3.0", "mri-3.1", "mri-3.2", "truffle-nightly", "ubuntu", "ubuntu32"]
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
        with:
          submodules: true
      - uses: ruby/setup-ruby@v1
        with:
          ruby-version: "3.1"
          bundler-cache: true
          bundler: latest
      - uses: docker/setup-buildx-action@v2
      - uses: docker/login-action@v2
        with:
          registry: ghcr.io
          username: ${{github.actor}}
          password: ${{secrets.GITHUB_TOKEN}}
      - name: ${{matrix.tag}}
        uses: docker/build-push-action@v3
        with:
          context: "."
          push: true
          tags: ghcr.io/sparklemotion/nokogiri-test:${{matrix.tag}}
          file: oci-images/nokogiri-test/${{matrix.tag}}.dockerfile
